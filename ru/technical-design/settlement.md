# Учет расчетов на блокчейне

## Логистика расчетов

> **Проблемы планирования задач в мире DeFi**

С тривиальными для традиционных систем, **планирование извлечения данных по времени является сложной задачей для блокчейна, так как смарт-контракты не имеют встроенного планировщика задач 'похожего на Cron'**. Как мы можем разработать автоматизированный механизм, чтобы гарантировать, что цены запланированы и обновлены вовремя в криптовалюте?

Крипто 'алго-стейблы', такие как Basis Cash или ESD, когда-то захватили сектор DeFi, применяя подход с интервалом 'эпохи', который требовал _ручного_ триггера для продвижения операций в конце каждой эпохи и установления новой цены расчета. **Механизмы вознаграждений были встроены в код смарт-контракта, чтобы побудить добровольцев 'инициировать продвижение'** и поддерживать протоколы в плавной работе. Аналогично, популярный проект под названием Keep3r, основанный Андре Кронье (Yearn Finance, Fantom), создал виртуальную доску объявлений, где можно было размещать запросы на продвижение и указывать вознаграждения за работу для этой очень специфической цели.

Ни одно из решений не было идеальным, так как они **в конечном итоге полагались на человеческое вмешательство** (мотивированные личные интересы), не говоря уже о **неопределенностях относительно фактического времени выполнения**, учитывая необходимые ручные усилия. Это может привести к неприятным ситуациям, когда фиксирование расчетов не обновляется до истечения срока, что приводит к менее удовлетворительному пользовательскому опыту.

Можем ли мы создать и полагаться на оффчейн-решения, которые требуют периодического триггирования обновлений цен? Хотя это возможно, **мы остаемся равнодушными к централизованным 'ярлыкам'**, где протокол может быть критически подвержен рискам, таким как сбой сервера.

Как упоминалось в нашем разделе ооракулах, SOFA использует **сервис автоматизации ChainLink в качестве источника цен для расчетов**. Их сервис позволяет условное выполнение функций смарт-контракта через надежную и децентрализованную платформу автоматизации с проверенной сетью внешних узлов, в настоящее время обеспечивающей более миллиарда в TVL.

Наконец, с **финальной ценой расчета на месте, пользователи и маркет-мейкеры могут в любой момент вызвать контракт, чтобы сжечь свой токен позиции и получить причитающийся платеж**, который рассчитывается без проблем смарт-контрактом с надежными данными от децентрализованных оракулов SOFA.

## Расчеты выплат

Контракт для расчета выплат по продуктам полностью стандартизирован, и он независим от хранилища и не зависит от обеспечения. Вместо этого **контракты на расчеты определяются типом структурированного продукта** для расчета модельных выплат. Некоторые примеры выплат приведены ниже:

### _В пределах диапазона_

- $$Payoff{maker}=\begin{cases}X, HighSettlePrice\geq HighStrikePrice\vee LowSettlePrice\leq LowStrikePrice\\  0, HighSettlePrice<HighStrikePrice\wedge LowSettlePrice>LowStrikePrice\end{cases}$$
- $$Payoff {user}=X - Payoff {maker}$$

### _Умный тренд_

#### _Бычий тренд_

- $$Payoff{maker}=\begin{cases}0, SettlePrice\geq HighStrikePrice\\
X\times\frac{HighStrikePrice-SettlePrice}{HighStrikePrice-LowStrikePrice},LowStrikePrice<SettlePrice<HighStrikePrice\\
X, SettlePrice\leq LowStrikePrice\end{cases}$$

- $$Payoff {user}=X - Payoff {maker}$$

#### _Медвежий тренд_

- $$Payoff{maker}=\begin{cases}X, SettlePrice\geq HighStrikePrice\\

X\times\frac{SettlePrice-LowStrikePrice}{HighStrikePrice-LowStrikePrice},LowStrikePrice<SettlePrice<HighStrikePrice\\
0, SettlePrice\leq LowStrikePrice\end{cases}$$

- $$Payoff {user}=X - Payoff {maker}$$