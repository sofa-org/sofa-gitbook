
# Oracle Construction

在加密货币和去中心化金融（DeFi）的世界中，**及时准确地获取链下数据至关重要。** 由于智能合约无法直接访问外部系统或数据源，预言机通过将外部信息引入区块链来弥合这一差距。必须提供可信的数据服务，以确保结算的完全透明和可追溯性，同时尽量减少可能的争议。

以高度去中心化、可靠性和适应性著称的**ChainLink**预言机服务被选为SOFA获取链下数据的主要方式。此外，使用ChainLink价格馈送还有**额外的好处，即保护协议免受“闪电贷攻击”**，而**数据馈送的来源将来自Coinbase等信誉良好的交易平台**，以确保数据的完整性。

![](../../static/chainlink.png)

SOFA利用[APRO Oracle](https://www.apro.com)来保护我们在多条链上的资产。来自**APRO Oracle**的支持和保护使我们能够保持链上资产的稳定性和安全性。有关更多信息，请参阅[APRO Oracle文档](https://docs.apro.com/en)。

![](../../static/apro.jpg)

## 现货价格 / 到期价格

通过预言机在链上获取基础资产的当前价格通常有两种方式：

- 从Uniswap等去中心化交易所（DEX）调用合约以获取基础资产的价格或时间加权平均价格（TWAP）
- 通过ChainLink等预言机服务提供的数据馈送获取资产价格

考虑到结算价格需要尽可能接近CeFi交易所价格（以便用户或做市商对冲）以及出于安全原因（避免操纵和攻击），我们**选择ChainLink的数据馈送作为我们的到期价格的预言机来源**。

通过ChainLink的去中心化数据源从不同交易所聚合的定价信息，我们确保我们的智能合约执行基于最新、可靠和最公平的公开可用定价数据集。

## 从历史收盘价计算得出的价格

对于像Rangebound这样的产品，需要知道从铸造开始到到期的基础代币的最高和最低价格，以计算最终支付。常见的链上通常无法提供此数据，因为链上预言机不提供连续的时间序列数据。

我们没有部署自己的预言机合约作为一种（常见的）中心化妥协，而是在**ChainLink的Functions产品**中找到了一个解决方案。得益于最新的创新，我们能够以去中心化的方式调用链下API，并通过像典型数据馈送一样的去中心化节点在链上发布获取的数据。

![](../../static/KxYlbnS0IoEtX6xAxV1uB0WKsLg.png)

## 自动化定期更新服务

SOFA利用ChainLink自动化服务，确保价格定期自动更新并推送到区块链上。ChainLink自动化提供了一个去中心化网络，智能合约可以在其中调度和自动执行复杂任务，包括间隔数据更新、触发事件，甚至关键合约调整。这**确保链上价格始终保持最新，并为SOFA的连接dApp网络提供数据信心**。

![](../../static/FESNbrjpEobC0DxtBz5u6Og0sgf.png)

## 去中心化和可追溯性

忠于我们的核心DeFi精神，**SOFA的价格数据检索过程将始终完全去中心化**，在合约层面提供完整的审计可追溯性。我们对透明处理的倡导确保系统中的每一步都可以被用户公开验证，定价数据的细节如提供者来源和聚合逻辑始终可观察。


## Oracle服务中的持续创新

尽管ChainLink仍然是DeFi数据可靠性的黄金标准，SOFA正在不断探索并了解oracle服务中的最新创新。我们意识到过度依赖有限的供应商来源的问题，并将**尽可能在技术上努力多样化我们的协议输入**。

从长远来看，SOFA力求为用户提供一个强大、透明、去中心化和可持续的数据获取系统，以保障用户利益，同时确保运营的长久性。
